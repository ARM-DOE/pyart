
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>&lt;no title&gt; &#8212; Py-ART 1.11.8 documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&display=swap');
</style>
    
      

    

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pyart-theme.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/doc_shared.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-304897822"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-304897822');
                </script>
 
<link
  rel="alternate"
  type="application/atom+xml"
  href="../blog/atom.xml"
  title="PyART Blog"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
  <nav class="navbar navbar-dark navbar-expand-lg bg-arm fixed-top bd-navbar shadow" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../index.html">
<p class="title">Py-ART</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../userguide/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../API/index.html">
  API Reference Manual
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../examples/index.html">
  Example Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../notebook-gallery.html">
  Notebook Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../blog.html">
  Blog
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference external nav-link" href="https://github.com/ARM-DOE/pyart/issues">
  GitHub Issue Tracker
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/ARM-DOE/pyart" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/Py_ART" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
  </nav>


    <div class="container-fluid" id="banner"></div>


    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="simple visible nav section-nav flex-column">
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                 <center>
![picture alt](http://www.arm.gov/images/template/logo.png "Title is optional")
#Using linear programming to do phase processing#
Scott Collis
<p>ARM Precipitation Sensitive Radar Translator</p>
<p><em>Argonne National Laboratory, Argonne, IL</em></p>
<p>Scott Giangrande</p>
<p>Meteorologist</p>
<p><em>Brookhaven National Laboratory, Brookhaven, NY</em></p>
<p>Import system libraries and append py-art path. import pyart</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">basedir</span><span class="o">=</span><span class="s1">&#39;/Users/scollis/local_modules/&#39;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basedir</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pyart.io</span> <span class="kn">import</span> <span class="n">py_mdv</span><span class="p">,</span> <span class="n">radar</span>
<span class="kn">from</span> <span class="nn">pyart.correct</span> <span class="kn">import</span> <span class="n">cband</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">groupby</span>
<span class="kn">import</span> <span class="nn">scipy.integrate</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">pyart.graph</span> <span class="kn">import</span> <span class="n">rayplot</span><span class="p">,</span> <span class="n">radar_display</span>
<span class="kn">from</span> <span class="nn">pyart.correct</span> <span class="kn">import</span> <span class="n">phase_proc</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pylab</span>
<span class="kn">import</span> <span class="nn">glpk</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reload</span><span class="p">(</span><span class="n">radar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;module &#39;pyart.io.radar&#39; from &#39;/Users/scollis/local_modules/pyart/io/radar.pyc&#39;&gt;
</pre></div>
</div>
</div>
</div>
<p>Read in the MDV file</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#sample_file_name=&#39;/data/sample_sapr_data/235545.mdv&#39;</span>
<span class="n">el</span><span class="p">,</span><span class="n">az</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">241</span><span class="p">)</span>
<span class="n">sample_file_name</span><span class="o">=</span><span class="s1">&#39;/data/095636.mdv&#39;</span>
<span class="n">my_mdv_object</span><span class="o">=</span><span class="n">py_mdv</span><span class="o">.</span><span class="n">read_mdv</span><span class="p">(</span><span class="n">sample_file_name</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Opening  /data/095636.mdv
Getting master header
getting field headers
getting vlevel headers
getting chunk headers
Reading Chunks
Calculating Radar coordinates
Making usable time objects
Calculating cartesian coordinates
indexing fields
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Now we convert the Py-MDV object to a Py-Radar object. This will help keep the code generic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myradar</span><span class="o">=</span><span class="n">radar</span><span class="o">.</span><span class="n">Radar</span><span class="p">(</span><span class="n">my_mdv_object</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  KDP_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  WIDTH_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  DBZ_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  PHIDP_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  ZDR_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  RHOHV_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  NCP_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  VEL_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Unfold phase.. Note the deepcopy otherwise it is a link and not a independant copy</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">min_phidp</span><span class="o">=</span><span class="mf">0.01</span><span class="p">;</span> <span class="n">min_ncp</span><span class="o">=</span><span class="mf">0.5</span><span class="p">;</span> <span class="n">min_rhv</span><span class="o">=</span><span class="mf">0.8</span><span class="p">;</span> <span class="n">fzl</span><span class="o">=</span><span class="mf">4000.0</span>
<span class="n">my_unf</span><span class="o">=</span><span class="n">phase_proc</span><span class="o">.</span><span class="n">get_phidp_unf</span><span class="p">(</span><span class="n">myradar</span><span class="p">,</span> <span class="n">ncp_lev</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">rhohv_lev</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">ncpts</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> 
<span class="c1">#No docking the end of the coverage. This comes later</span>
<span class="n">my_new_ph</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;dp_phase_shift&#39;</span><span class="p">])</span>
<span class="n">my_unf</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">my_unf</span><span class="p">[:,</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">my_new_ph</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">my_unf</span>
<span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;unf_dp_phase_shift&#39;</span><span class="p">:</span><span class="n">my_new_ph</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>Now we create some conditional fields which will be used in the construction of the constraints</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">is_low_z</span><span class="o">=</span><span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;reflectivity_horizontal&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">&lt;</span><span class="mf">10.0</span>
<span class="n">is_high_z</span><span class="o">=</span><span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;reflectivity_horizontal&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">&gt;</span><span class="mf">53.0</span>
<span class="n">z_mod</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;reflectivity_horizontal&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
<span class="n">z_mod</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_high_z</span><span class="p">)]</span><span class="o">=</span><span class="mf">53.0</span>
<span class="n">z_mod</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_low_z</span><span class="p">)]</span><span class="o">=</span><span class="mf">10.0</span>
<span class="c1">#z_mod=z_mod</span>
<span class="n">not_coherent</span><span class="o">=</span><span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;norm_coherent_power&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_ncp</span>
<span class="n">not_correlated</span><span class="o">=</span><span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;copol_coeff&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_rhv</span>
<span class="n">phidp_mod</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;unf_dp_phase_shift&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
<span class="n">phidp_neg</span><span class="o">=</span><span class="n">phidp_mod</span> <span class="o">&lt;</span> <span class="n">min_phidp</span>
<span class="n">phidp_mod</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">phidp_neg</span><span class="p">)]</span><span class="o">=</span><span class="n">min_phidp</span>
<span class="n">phidp_mod</span><span class="o">=</span><span class="n">phidp_mod</span>
</pre></div>
</div>
</div>
</div>
<p>Ok, What do we want here? We have the A matrix which is the block matrix given by:
$<span class="math notranslate nohighlight">\(\bf{A}=\begin{bmatrix} \bf{I} &amp; \bf{-I} \\\\ \bf{-I}&amp; \bf{I} \\\\ \bf{Z} &amp; \bf{M} \end{bmatrix} \)</span><span class="math notranslate nohighlight">\(
where \)</span>\bf{I}<span class="math notranslate nohighlight">\( is the identity matrix, \)</span>\bf{Z}<span class="math notranslate nohighlight">\( is a matrix of zeros and \)</span>\bf{M}<span class="math notranslate nohighlight">\( contains our differential constraints. Each block is of shape n_gates by n_gates making shape(\)</span>\bf{A}$)=(3<em>n, 2</em>n).</p>
<p>Note that <span class="math notranslate nohighlight">\(\bf{M}\)</span> contains some side padding to deal with edge issues</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">construct_A_matrix</span><span class="p">(</span><span class="n">radar</span><span class="p">):</span>
    <span class="n">n_gates</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">radar</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
    <span class="n">Identity</span><span class="o">=</span><span class="n">eye</span><span class="p">(</span><span class="n">n_gates</span><span class="p">)</span>
    <span class="n">St_Gorlv_differential_5pts</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="mf">.2</span><span class="p">]</span>
    <span class="n">filt</span><span class="o">=</span><span class="n">St_Gorlv_differential_5pts</span>
    <span class="n">filter_length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">filt</span><span class="p">)</span>
    <span class="n">M_matrix_middle</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">ones</span><span class="p">(</span><span class="n">n_gates</span><span class="o">-</span><span class="n">filter_length</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mf">0.0</span>
    <span class="n">posn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="p">(</span><span class="n">filter_length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">filter_length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">filter_length</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">diag</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">filter_length</span><span class="p">):</span>
        <span class="n">M_matrix_middle</span><span class="o">=</span><span class="n">M_matrix_middle</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">ones</span><span class="p">(</span><span class="n">n_gates</span><span class="o">-</span><span class="n">filter_length</span><span class="o">+</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">posn</span><span class="p">[</span><span class="n">diag</span><span class="p">])),</span> <span class="n">k</span><span class="o">=</span><span class="n">posn</span><span class="p">[</span><span class="n">diag</span><span class="p">])</span><span class="o">*</span><span class="n">filt</span><span class="p">[</span><span class="n">diag</span><span class="p">]</span>
    <span class="n">side_pad</span><span class="o">=</span><span class="p">(</span><span class="n">filter_length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">M_matrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bmat</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_gates</span><span class="o">-</span><span class="n">filter_length</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">side_pad</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
        <span class="n">M_matrix_middle</span><span class="p">,</span> 
        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_gates</span><span class="o">-</span><span class="n">filter_length</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">side_pad</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)])</span>
    <span class="n">Z_matrix</span><span class="o">=</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_gates</span><span class="o">-</span><span class="n">filter_length</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_gates</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">bmat</span><span class="p">([[</span><span class="n">Identity</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">Identity</span><span class="p">],</span> <span class="p">[</span><span class="n">Identity</span><span class="p">,</span> <span class="n">Identity</span><span class="p">],</span> <span class="p">[</span><span class="n">Z_matrix</span><span class="p">,</span> <span class="n">M_matrix</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A_Matrix</span><span class="o">=</span><span class="n">construct_A_matrix</span><span class="p">(</span><span class="n">myradar</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">A_Matrix</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">A_Matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">myradar</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])),</span> <span class="n">A_Matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">myradar</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2945, 1966)
(2.995930824008138, 2.0)
</pre></div>
</div>
</div>
</div>
<p>Ok, now is where we have to get clever. <span class="math notranslate nohighlight">\(\bf{A}\)</span> is constant for the radar (the radar object pads gates with _Fill_Value, making the time-range array rectangular). But the B vector of the objective constraints is not as it contains reflectivity info. Now we want to use Scientific Python array based processing to take advantage of the optimized code backend.
The B vector is the negatibe and positive modified unfolded <span class="math notranslate nohighlight">\(\phi_{DP}\)</span> and the self consistency constraint which uses converts <span class="math notranslate nohighlight">\(Z\)</span> to <span class="math notranslate nohighlight">\(K_{DP}\)</span> and integrates to give a <span class="math notranslate nohighlight">\(\phi_{DP}\)</span> like field.</p>
<p><span class="math notranslate nohighlight">\(\bf{B}=\begin{bmatrix} -\bf{\phi_{DP}} \\\\ \bf{\phi_{DP}} \\\\ \bf{\eta} \end{bmatrix}\)</span></p>
<p>Now we want to array-ize this effectively making <span class="math notranslate nohighlight">\(\bf{B}\)</span> a matrix consiting of:</p>
<p><span class="math notranslate nohighlight">\(\bf{B_{mat}}=\begin{bmatrix} -\bf{\phi_{DP}^{(1)}} &amp; \cdots &amp; -\bf{\phi_{DP}^{(n)}} \\\\ \bf{\phi_{DP}^{(1)}} &amp; \cdots &amp; \bf{\phi_{DP}^{(n)}} \\\\ \bf{\eta}^{(1)} &amp; \cdots &amp; \bf{\eta}^{(n)} \end{bmatrix}\)</span></p>
<p>where n is the number of rays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">St_Gorlv_differential_5pts</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="mf">.2</span><span class="p">]</span>
<span class="n">filt</span><span class="o">=</span><span class="n">St_Gorlv_differential_5pts</span>
<span class="n">n_gates</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">myradar</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
<span class="n">n_rays</span><span class="o">=</span><span class="n">phidp_mod</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">filter_length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">filt</span><span class="p">)</span>
<span class="n">side_pad</span><span class="o">=</span><span class="p">(</span><span class="n">filter_length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="nb">print</span> <span class="s2">&quot;Side pad: &quot;</span><span class="p">,</span> <span class="n">side_pad</span>
<span class="n">top_of_B_vectors</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bmat</span><span class="p">([[</span><span class="o">-</span><span class="n">phidp_mod</span><span class="p">,</span><span class="n">phidp_mod</span><span class="p">]])</span>
<span class="nb">print</span> <span class="n">top_of_B_vectors</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">phidp_mod</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="mf">360.0</span><span class="o">*</span><span class="mf">17.0</span>
<span class="n">data_edges</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bmat</span><span class="p">([</span><span class="n">phidp_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">side_pad</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_rays</span><span class="p">,</span> <span class="n">n_gates</span><span class="o">-</span><span class="n">filter_length</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span> <span class="n">phidp_mod</span><span class="p">[:,</span><span class="o">-</span><span class="n">side_pad</span><span class="p">:]])</span>
<span class="nb">print</span> <span class="n">data_edges</span><span class="o">.</span><span class="n">shape</span>
<span class="n">ii</span><span class="o">=</span><span class="n">filter_length</span><span class="o">-</span><span class="mi">1</span>
<span class="n">jj</span><span class="o">=</span><span class="n">data_edges</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
<span class="n">list_corrl</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_rays</span><span class="p">,</span> <span class="n">jj</span><span class="o">-</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_corrl</span><span class="p">)</span>
<span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">list_corrl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">list_corrl</span><span class="p">[:,</span> <span class="n">count</span><span class="p">]</span><span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">filt</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data_edges</span><span class="p">))[:,</span> <span class="n">count</span><span class="p">:</span><span class="n">count</span><span class="o">+</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">list_corrl</span><span class="o">.</span><span class="n">shape</span>

<span class="c1">#list_corrl=np.zeros(jj-ii+1)</span>
<span class="c1">#for count in range(len(list_corrl)):</span>
<span class="c1">#    list_corrl[count]= -1.0*(array(SG_df5)*np.squeeze(np.asarray(data_edges))[count:count+ii+1]).sum()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Side pad:  2
(6120, 1966)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> (6120, 983) 6120.0
(6120, 983)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6120
(6120, 979)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Now for the self consistency constraint.. We are going want a gradient in <span class="math notranslate nohighlight">\(\phi_{DP}\)</span> consistent with <span class="math notranslate nohighlight">\(Z_{dB}\)</span> according to:</p>
<p><span class="math notranslate nohighlight">\(\eta=\frac{(10^{0.1*Z_{dB}})^{0.914}}{w}\)</span></p>
<p>where <span class="math notranslate nohighlight">\(w\)</span> is the (inverse) weight, and is determined by trail and error, and in our case is set to 50,000</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sct</span><span class="o">=</span><span class="p">(((</span><span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="mf">0.1</span><span class="o">*</span><span class="n">z_mod</span><span class="p">))</span><span class="o">**</span><span class="mf">0.914</span><span class="p">)</span><span class="o">/</span><span class="mf">60000.0</span><span class="p">)[:,</span> <span class="n">side_pad</span><span class="p">:</span><span class="o">-</span><span class="n">side_pad</span><span class="p">]</span>
<span class="n">sct</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sct</span> <span class="o">&lt;</span><span class="mf">0.0</span><span class="p">)]</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">sct</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">side_pad</span><span class="p">]</span><span class="o">=</span><span class="n">list_corrl</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">side_pad</span><span class="p">]</span>
<span class="n">sct</span><span class="p">[:,</span> <span class="o">-</span><span class="n">side_pad</span><span class="p">:]</span><span class="o">=</span><span class="n">list_corrl</span><span class="p">[:,</span> <span class="o">-</span><span class="n">side_pad</span><span class="p">:]</span>
<span class="nb">print</span> <span class="n">top_of_B_vectors</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span> <span class="n">sct</span><span class="o">.</span><span class="n">shape</span>
<span class="n">B_vectors</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bmat</span><span class="p">([[</span><span class="n">top_of_B_vectors</span><span class="p">,</span><span class="n">sct</span><span class="p">]])</span>
<span class="nb">print</span> <span class="n">B_vectors</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span> <span class="n">A_Matrix</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6120, 1966)
(6120, 979)
(6120, 2945)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2945, 1966)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">my_new_ph</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">phidp_neg</span><span class="o">=</span><span class="n">my_new_ph</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">min_phidp</span>
<span class="n">my_new_ph</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">phidp_neg</span><span class="p">)]</span><span class="o">=</span><span class="n">min_phidp</span>
<span class="c1">#not_coh=my_ncp[el,az, 0:fzl_e] &lt; min_ncp</span>
<span class="c1">#not_cor=my_rhv[el,az, 0:fzl_e] &lt; min_rhv</span>
<span class="c1">#need to impliment these up to the FZL</span>
<span class="n">is_garbage</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span> <span class="n">not_coherent</span><span class="p">,</span> <span class="n">not_correlated</span><span class="p">)</span>
<span class="n">m</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_garbage</span><span class="p">)</span>
<span class="n">weights</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">=</span><span class="mf">1.0</span>
<span class="nb">print</span> <span class="n">weights</span><span class="o">.</span><span class="n">shape</span>
<span class="n">nw</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bmat</span><span class="p">([</span><span class="n">weights</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="p">)])</span>
<span class="nb">print</span> <span class="n">nw</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">B_vectors</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">A_Matrix</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6120, 983)
(6120, 1966)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> (6120, 2945) (2945, 1966)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">raynum</span><span class="o">=</span><span class="mi">330</span>
<span class="n">mysoln</span><span class="o">=</span><span class="n">zeros</span><span class="p">(</span><span class="n">phidp_mod</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="nn">glpk</span>
           <span class="c1"># Import the GLPK module</span>
<span class="n">t0</span><span class="o">=</span><span class="n">time</span><span class="p">()</span>
<span class="n">lp</span> <span class="o">=</span> <span class="n">glpk</span><span class="o">.</span><span class="n">LPX</span><span class="p">()</span>        <span class="c1"># Create empty problem instance</span>
<span class="n">lp</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;LP_MIN&#39;</span>     <span class="c1"># Assign symbolic name to problem</span>
<span class="n">lp</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">maximize</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Set this as a maximization problem</span>
<span class="c1">#lp.rows.add(2*n)         # Append rows </span>
<span class="n">lp</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n_gates</span><span class="o">+</span><span class="n">n_gates</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="c1"># Append rows </span>
<span class="n">lp</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n_gates</span><span class="p">)</span>

<span class="n">glpk</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">term_on</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">for</span> <span class="n">cur_row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n_gates</span><span class="o">+</span><span class="n">n_gates</span><span class="o">-</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">lp</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">cur_row</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">A_Matrix</span><span class="p">[</span><span class="n">cur_row</span><span class="p">,</span> <span class="p">:])))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n_gates</span><span class="p">):</span>
    <span class="n">lp</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span>

<span class="k">for</span> <span class="n">raynum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">360</span><span class="p">):</span>
    <span class="n">this_soln</span><span class="o">=</span><span class="n">zeros</span><span class="p">(</span><span class="n">phidp_mod</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1">#print &quot;Doing&quot;, raynum</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n_gates</span><span class="o">+</span><span class="n">n_gates</span><span class="o">-</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">lp</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="n">B_vectors</span><span class="p">[</span><span class="n">raynum</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n_gates</span><span class="p">):</span>
        <span class="c1">#lp.cols[i].bounds = 0.0, None</span>
        <span class="n">lp</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">nw</span><span class="p">[</span><span class="n">raynum</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
    <span class="n">lp</span><span class="o">.</span><span class="n">simplex</span><span class="p">(</span><span class="n">msg_lev</span><span class="o">=</span><span class="n">glpk</span><span class="o">.</span><span class="n">LPX</span><span class="o">.</span><span class="n">MSG_ON</span><span class="p">,</span> <span class="n">meth</span><span class="o">=</span><span class="n">glpk</span><span class="o">.</span><span class="n">LPX</span><span class="o">.</span><span class="n">PRIMAL</span><span class="p">,</span> <span class="n">it_lim</span><span class="o">=</span><span class="mi">7000</span><span class="p">,</span> <span class="n">presolve</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gates</span><span class="p">):</span>
        <span class="n">this_soln</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">lp</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">n_gates</span><span class="p">]</span><span class="o">.</span><span class="n">primal</span>
    <span class="n">mysoln</span><span class="p">[</span><span class="n">raynum</span><span class="p">,</span> <span class="p">:]</span><span class="o">=</span><span class="n">cband</span><span class="o">.</span><span class="n">smooth_and_trim</span><span class="p">(</span><span class="n">this_soln</span><span class="p">,</span> <span class="n">window_len</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s1">&#39;sg_smooth&#39;</span><span class="p">)</span>


</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proc_ph</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;dp_phase_shift&#39;</span><span class="p">])</span>
<span class="n">proc_ph</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mysoln</span>
<span class="n">proc_ph</span><span class="p">[</span><span class="s1">&#39;valid_min&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">proc_ph</span><span class="p">[</span><span class="s1">&#39;valid_max&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">400.0</span>

<span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;proc_dp_phase_shift&#39;</span><span class="p">:</span><span class="n">proc_ph</span><span class="p">})</span>
<span class="n">kdp</span><span class="o">=</span><span class="n">zeros</span><span class="p">(</span><span class="n">mysoln</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mysoln</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">kdp</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">=</span><span class="n">cband</span><span class="o">.</span><span class="n">sobel</span><span class="p">(</span><span class="n">mysoln</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">window_len</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">myradar</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">myradar</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">)</span>

<span class="n">sob_kdp</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;diff_phase&#39;</span><span class="p">])</span>
<span class="n">sob_kdp</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kdp</span>
<span class="n">sob_kdp</span><span class="p">[</span><span class="s1">&#39;valid_min&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">sob_kdp</span><span class="p">[</span><span class="s1">&#39;valid_max&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">20.0</span>

<span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;recalculated_diff_phase&#39;</span><span class="p">:</span><span class="n">sob_kdp</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d_az</span><span class="p">,</span><span class="n">d_el</span><span class="o">=</span><span class="mi">190</span><span class="p">,</span><span class="mi">0</span>
<span class="n">f</span><span class="o">=</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">plot</span><span class="p">(</span><span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;proc_dp_phase_shift&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">d_az</span><span class="o">+</span><span class="mi">360</span><span class="o">*</span><span class="n">d_el</span><span class="p">,</span> <span class="p">:],</span><span class="s1">&#39;b-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;unf_dp_phase_shift&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">d_az</span><span class="o">+</span><span class="mi">360</span><span class="o">*</span><span class="n">d_el</span><span class="p">,</span> <span class="p">:],</span><span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">)</span>
<span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">290</span><span class="p">])</span>
<span class="n">twinx</span><span class="p">()</span>
<span class="c1">#plot(z_mod, &#39;r-&#39;, label=&#39;z&#39;)</span>
<span class="c1">#xlim([500,1000])</span>
<span class="c1">#cband.KDP(mysoln, my_mdv_object.range_km[1]-my_mdv_object.range_km[0], 30)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;recalculated_diff_phase&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">d_az</span><span class="o">+</span><span class="mi">360</span><span class="o">*</span><span class="n">d_el</span><span class="p">,</span> <span class="p">:],</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
<span class="c1">#plot(z_mod/10)</span>
<span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">=</span><span class="n">figure</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/differential_phase_proceesing_using_LP_methods_22_0.png" src="../_images/differential_phase_proceesing_using_LP_methods_22_0.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.figure.Figure at 0x10c953e10&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_display</span><span class="o">=</span><span class="n">radar_display</span><span class="o">.</span><span class="n">radar_display</span><span class="p">(</span><span class="n">myradar</span><span class="p">)</span>
<span class="n">f</span><span class="o">=</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">my_display</span><span class="o">.</span><span class="n">plot_ppi</span><span class="p">(</span><span class="s1">&#39;proc_dp_phase_shift&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">my_display</span><span class="o">.</span><span class="n">append_x</span><span class="p">()</span>
<span class="n">my_display</span><span class="o">.</span><span class="n">append_y</span><span class="p">()</span>
<span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">my_display</span><span class="o">.</span><span class="n">generate_title</span><span class="p">(</span><span class="s1">&#39;proc_dp_phase_shift&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">my_display</span><span class="o">.</span><span class="n">add_cb</span><span class="p">()</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">my_display</span><span class="o">.</span><span class="n">plot_ppi</span><span class="p">(</span><span class="s1">&#39;recalculated_diff_phase&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">my_display</span><span class="o">.</span><span class="n">generate_title</span><span class="p">(</span><span class="s1">&#39;recalculated_diff_phase&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">my_display</span><span class="o">.</span><span class="n">append_x</span><span class="p">()</span>
<span class="n">my_display</span><span class="o">.</span><span class="n">add_cb</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/differential_phase_proceesing_using_LP_methods_23_0.png" src="../_images/differential_phase_proceesing_using_LP_methods_23_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reload</span><span class="p">(</span><span class="n">rayplot</span><span class="p">)</span>
<span class="n">myrayplot</span><span class="o">=</span><span class="n">rayplot</span><span class="o">.</span><span class="n">rayplot</span><span class="p">(</span><span class="n">myradar</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">])</span>
<span class="n">myrayplot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">190</span><span class="p">],</span><span class="n">myradar</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">myrayplot</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/differential_phase_proceesing_using_LP_methods_24_0.png" src="../_images/differential_phase_proceesing_using_LP_methods_24_0.png" />
</div>
</div>

<div class="section">
   
</div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2013-2022, Py-ART developers.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>