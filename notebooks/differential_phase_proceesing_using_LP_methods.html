
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>&lt;no title&gt; &#8212; Py-ART 0.0.0 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pyart-theme.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/doc_shared.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-JJEG3CV376"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-JJEG3CV376');
                </script>
 
<link
  rel="alternate"
  type="application/atom+xml"
  href="../blog/atom.xml"
  title="PyART Blog"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
  <nav class="navbar navbar-dark navbar-expand-lg bg-arm fixed-top bd-navbar shadow" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../index.html">
<p class="title">Py-ART</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../userguide/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../API/index.html">
  API Reference Manual
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../examples/index.html">
  Example Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../notebook-gallery.html">
  Notebook Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../blog.html">
  Blog
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../changelog.html">
  Changelog
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/ARM-DOE/pyart" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/Py_ART" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
  </nav>


    <div class="container-fluid" id="banner"></div>


    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="simple visible nav section-nav flex-column">
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                 <center>
![picture alt](http://www.arm.gov/images/template/logo.png "Title is optional")
#Using linear programming to do phase processing#
Scott Collis
<p>ARM Precipitation Sensitive Radar Translator</p>
<p><em>Argonne National Laboratory, Argonne, IL</em></p>
<p>Scott Giangrande</p>
<p>Meteorologist</p>
<p><em>Brookhaven National Laboratory, Brookhaven, NY</em></p>
<p>Import system libraries and append py-art path. import pyart</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>basedir=&#39;/Users/scollis/local_modules/&#39;
import sys
sys.path.append(basedir)
from pyart.io import py_mdv, radar
from pyart.correct import cband
from time import time
from itertools import groupby
import scipy.integrate
from scipy.interpolate import interp1d
from pyart.graph import rayplot, radar_display
from pyart.correct import phase_proc
import copy
import numpy as np
import pylab
import glpk 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>reload(radar)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;module &#39;pyart.io.radar&#39; from &#39;/Users/scollis/local_modules/pyart/io/radar.pyc&#39;&gt;
</pre></div>
</div>
</div>
</div>
<p>Read in the MDV file</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#sample_file_name=&#39;/data/sample_sapr_data/235545.mdv&#39;
el,az=(1,241)
sample_file_name=&#39;/data/095636.mdv&#39;
my_mdv_object=py_mdv.read_mdv(sample_file_name, debug=True)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Opening  /data/095636.mdv
Getting master header
getting field headers
getting vlevel headers
getting chunk headers
Reading Chunks
Calculating Radar coordinates
Making usable time objects
Calculating cartesian coordinates
indexing fields
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Now we convert the Py-MDV object to a Py-Radar object. This will help keep the code generic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>myradar=radar.Radar(my_mdv_object)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  KDP_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  WIDTH_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  DBZ_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  PHIDP_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  ZDR_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  RHOHV_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  NCP_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing  VEL_F
go
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Unfold phase.. Note the deepcopy otherwise it is a link and not a independant copy</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>min_phidp=0.01; min_ncp=0.5; min_rhv=0.8; fzl=4000.0
my_unf=phase_proc.get_phidp_unf(myradar, ncp_lev=0.5, rhohv_lev=0.7, ncpts=2, doc=None) 
#No docking the end of the coverage. This comes later
my_new_ph=copy.deepcopy(myradar.fields[&#39;dp_phase_shift&#39;])
my_unf[:,-1]=my_unf[:,-2]
my_new_ph[&#39;data&#39;]=my_unf
myradar.fields.update({&#39;unf_dp_phase_shift&#39;:my_new_ph})
</pre></div>
</div>
</div>
</div>
<p>Now we create some conditional fields which will be used in the construction of the constraints</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>is_low_z=myradar.fields[&#39;reflectivity_horizontal&#39;][&#39;data&#39;] &lt;10.0
is_high_z=myradar.fields[&#39;reflectivity_horizontal&#39;][&#39;data&#39;] &gt;53.0
z_mod=copy.deepcopy(myradar.fields[&#39;reflectivity_horizontal&#39;][&#39;data&#39;])
z_mod[np.where(is_high_z)]=53.0
z_mod[np.where(is_low_z)]=10.0
#z_mod=z_mod
not_coherent=myradar.fields[&#39;norm_coherent_power&#39;][&#39;data&#39;] &lt; min_ncp
not_correlated=myradar.fields[&#39;copol_coeff&#39;][&#39;data&#39;] &lt; min_rhv
phidp_mod=copy.deepcopy(myradar.fields[&#39;unf_dp_phase_shift&#39;][&#39;data&#39;])
phidp_neg=phidp_mod &lt; min_phidp
phidp_mod[np.where(phidp_neg)]=min_phidp
phidp_mod=phidp_mod
</pre></div>
</div>
</div>
</div>
<p>Ok, What do we want here? We have the A matrix which is the block matrix given by:
$<span class="math notranslate nohighlight">\(\bf{A}=\begin{bmatrix} \bf{I} &amp; \bf{-I} \\\\ \bf{-I}&amp; \bf{I} \\\\ \bf{Z} &amp; \bf{M} \end{bmatrix} \)</span><span class="math notranslate nohighlight">\(
where \)</span>\bf{I}<span class="math notranslate nohighlight">\( is the identity matrix, \)</span>\bf{Z}<span class="math notranslate nohighlight">\( is a matrix of zeros and \)</span>\bf{M}<span class="math notranslate nohighlight">\( contains our differential constraints. Each block is of shape n_gates by n_gates making shape(\)</span>\bf{A}$)=(3<em>n, 2</em>n).</p>
<p>Note that <span class="math notranslate nohighlight">\(\bf{M}\)</span> contains some side padding to deal with edge issues</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>def construct_A_matrix(radar):
    n_gates=len(radar.range[&#39;data&#39;])
    Identity=eye(n_gates)
    St_Gorlv_differential_5pts=[-.2, -.1, 0, .1, .2]
    filt=St_Gorlv_differential_5pts
    filter_length=len(filt)
    M_matrix_middle=np.diag(ones(n_gates-filter_length+1), k=0)*0.0
    posn=np.linspace(-1.0*(filter_length-1)/2, (filter_length-1)/2, filter_length)
    for diag in range(filter_length):
        M_matrix_middle=M_matrix_middle+np.diag(ones(n_gates-filter_length+1 - np.abs(posn[diag])), k=posn[diag])*filt[diag]
    side_pad=(filter_length-1)/2
    M_matrix=np.bmat([np.zeros([n_gates-filter_length+1, side_pad], dtype=float),
        M_matrix_middle, 
        np.zeros([n_gates-filter_length+1, side_pad], dtype=float)])
    Z_matrix=zeros([n_gates-filter_length+1, n_gates])
    return np.bmat([[Identity, -1.0*Identity], [Identity, Identity], [Z_matrix, M_matrix]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>A_Matrix=construct_A_matrix(myradar)
print A_Matrix.shape
print (A_Matrix.shape[0]/float(len(myradar.range[&#39;data&#39;])), A_Matrix.shape[1]/float(len(myradar.range[&#39;data&#39;])))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2945, 1966)
(2.995930824008138, 2.0)
</pre></div>
</div>
</div>
</div>
<p>Ok, now is where we have to get clever. <span class="math notranslate nohighlight">\(\bf{A}\)</span> is constant for the radar (the radar object pads gates with _Fill_Value, making the time-range array rectangular). But the B vector of the objective constraints is not as it contains reflectivity info. Now we want to use Scientific Python array based processing to take advantage of the optimized code backend.
The B vector is the negatibe and positive modified unfolded <span class="math notranslate nohighlight">\(\phi_{DP}\)</span> and the self consistency constraint which uses converts <span class="math notranslate nohighlight">\(Z\)</span> to <span class="math notranslate nohighlight">\(K_{DP}\)</span> and integrates to give a <span class="math notranslate nohighlight">\(\phi_{DP}\)</span> like field.</p>
<p><span class="math notranslate nohighlight">\(\bf{B}=\begin{bmatrix} -\bf{\phi_{DP}} \\\\ \bf{\phi_{DP}} \\\\ \bf{\eta} \end{bmatrix}\)</span></p>
<p>Now we want to array-ize this effectively making <span class="math notranslate nohighlight">\(\bf{B}\)</span> a matrix consiting of:</p>
<p><span class="math notranslate nohighlight">\(\bf{B_{mat}}=\begin{bmatrix} -\bf{\phi_{DP}^{(1)}} &amp; \cdots &amp; -\bf{\phi_{DP}^{(n)}} \\\\ \bf{\phi_{DP}^{(1)}} &amp; \cdots &amp; \bf{\phi_{DP}^{(n)}} \\\\ \bf{\eta}^{(1)} &amp; \cdots &amp; \bf{\eta}^{(n)} \end{bmatrix}\)</span></p>
<p>where n is the number of rays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>St_Gorlv_differential_5pts=[-.2, -.1, 0, .1, .2]
filt=St_Gorlv_differential_5pts
n_gates=len(myradar.range[&#39;data&#39;])
n_rays=phidp_mod.shape[0]
filter_length=len(filt)
side_pad=(filter_length-1)/2
print &quot;Side pad: &quot;, side_pad
top_of_B_vectors=np.bmat([[-phidp_mod,phidp_mod]])
print top_of_B_vectors.shape, phidp_mod.shape, 360.0*17.0
data_edges=np.bmat([phidp_mod[:, 0:side_pad], np.zeros([n_rays, n_gates-filter_length+1]), phidp_mod[:,-side_pad:]])
print data_edges.shape
ii=filter_length-1
jj=data_edges.shape[1]-1
list_corrl=np.zeros([n_rays, jj-ii+1])
print len(list_corrl)
for count in range(list_corrl.shape[1]):
    list_corrl[:, count]= -1.0*(array(filt)*(np.asarray(data_edges))[:, count:count+ii+1]).sum(axis=1)
print list_corrl.shape

#list_corrl=np.zeros(jj-ii+1)
#for count in range(len(list_corrl)):
#    list_corrl[count]= -1.0*(array(SG_df5)*np.squeeze(np.asarray(data_edges))[count:count+ii+1]).sum()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Side pad:  2
(6120, 1966)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> (6120, 983) 6120.0
(6120, 983)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6120
(6120, 979)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Now for the self consistency constraint.. We are going want a gradient in <span class="math notranslate nohighlight">\(\phi_{DP}\)</span> consistent with <span class="math notranslate nohighlight">\(Z_{dB}\)</span> according to:</p>
<p><span class="math notranslate nohighlight">\(\eta=\frac{(10^{0.1*Z_{dB}})^{0.914}}{w}\)</span></p>
<p>where <span class="math notranslate nohighlight">\(w\)</span> is the (inverse) weight, and is determined by trail and error, and in our case is set to 50,000</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sct=(((10.0**(0.1*z_mod))**0.914)/60000.0)[:, side_pad:-side_pad]
sct[np.where(sct &lt;0.0)]=0.0
sct[:, 0:side_pad]=list_corrl[:, 0:side_pad]
sct[:, -side_pad:]=list_corrl[:, -side_pad:]
print top_of_B_vectors.shape
print sct.shape
B_vectors=np.bmat([[top_of_B_vectors,sct]])
print B_vectors.shape
print A_Matrix.shape
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6120, 1966)
(6120, 979)
(6120, 2945)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2945, 1966)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>weights=np.zeros(my_new_ph[&#39;data&#39;].shape)
phidp_neg=my_new_ph[&#39;data&#39;] &lt;min_phidp
my_new_ph[&#39;data&#39;][np.where(phidp_neg)]=min_phidp
#not_coh=my_ncp[el,az, 0:fzl_e] &lt; min_ncp
#not_cor=my_rhv[el,az, 0:fzl_e] &lt; min_rhv
#need to impliment these up to the FZL
is_garbage=np.logical_or( not_coherent, not_correlated)
m=np.where(is_garbage)
weights[m]=1.0
print weights.shape
nw=np.bmat([weights, np.zeros(weights.shape)])
print nw.shape, B_vectors.shape, A_Matrix.shape
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6120, 983)
(6120, 1966)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> (6120, 2945) (2945, 1966)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>raynum=330
mysoln=zeros(phidp_mod.shape)

from time import time
import glpk
           # Import the GLPK module
t0=time()
lp = glpk.LPX()        # Create empty problem instance
lp.name = &#39;LP_MIN&#39;     # Assign symbolic name to problem
lp.obj.maximize = False # Set this as a maximization problem
#lp.rows.add(2*n)         # Append rows 
lp.rows.add(2*n_gates+n_gates-4)# Append rows 
lp.cols.add(2*n_gates)

glpk.env.term_on = True

for cur_row in range(2*n_gates+n_gates-4):
    lp.rows[cur_row].matrix=list(np.squeeze(np.asarray(A_Matrix[cur_row, :])))
for i in range(2*n_gates):
    lp.cols[i].bounds = 0.0, None

for raynum in range(360):
    this_soln=zeros(phidp_mod.shape[1])
    #print &quot;Doing&quot;, raynum
    for i in range(2*n_gates+n_gates-4):
        lp.rows[i].bounds = B_vectors[raynum, i], None
    for i in range(2*n_gates):
        #lp.cols[i].bounds = 0.0, None
        lp.obj[i]=nw[raynum,i]
    lp.simplex(msg_lev=glpk.LPX.MSG_ON, meth=glpk.LPX.PRIMAL, it_lim=7000, presolve=True)
    for i in range(n_gates):
        this_soln[i]=lp.cols[i+n_gates].primal
    mysoln[raynum, :]=cband.smooth_and_trim(this_soln, window_len=5, window=&#39;sg_smooth&#39;)


</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>proc_ph=copy.deepcopy(myradar.fields[&#39;dp_phase_shift&#39;])
proc_ph[&#39;data&#39;]=mysoln
proc_ph[&#39;valid_min&#39;]=0.0
proc_ph[&#39;valid_max&#39;]=400.0

myradar.fields.update({&#39;proc_dp_phase_shift&#39;:proc_ph})
kdp=zeros(mysoln.shape)
for i in range(mysoln.shape[0]):
    kdp[i,:]=cband.sobel(mysoln[i, :], window_len=35)/((myradar.range[&#39;data&#39;][1]-myradar.range[&#39;data&#39;][0])/1000.0)

sob_kdp=copy.deepcopy(myradar.fields[&#39;diff_phase&#39;])
sob_kdp[&#39;data&#39;]=kdp
sob_kdp[&#39;valid_min&#39;]=0.0
sob_kdp[&#39;valid_max&#39;]=20.0

myradar.fields.update({&#39;recalculated_diff_phase&#39;:sob_kdp})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>d_az,d_el=190,0
f=figure(figsize=[10,5])
plot(myradar.fields[&#39;proc_dp_phase_shift&#39;][&#39;data&#39;][d_az+360*d_el, :],&#39;b-&#39;,label=&#39;LP&#39;)
plot(myradar.fields[&#39;unf_dp_phase_shift&#39;][&#39;data&#39;][d_az+360*d_el, :],&#39;g-&#39;, label=&#39;raw&#39;)
ylim([0,290])
twinx()
#plot(z_mod, &#39;r-&#39;, label=&#39;z&#39;)
#xlim([500,1000])
#cband.KDP(mysoln, my_mdv_object.range_km[1]-my_mdv_object.range_km[0], 30)
plot(myradar.fields[&#39;recalculated_diff_phase&#39;][&#39;data&#39;][d_az+360*d_el, :], &#39;r-&#39;)
#plot(z_mod/10)
gca().yaxis.grid(color=&#39;gray&#39;, linestyle=&#39;dashed&#39;)
f=figure()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ce24a4923524e32821d4cadf9ce953e2c5d137d1f4c5a6b4dff7cc16f5b8f2ec.png" src="../_images/ce24a4923524e32821d4cadf9ce953e2c5d137d1f4c5a6b4dff7cc16f5b8f2ec.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.figure.Figure at 0x10c953e10&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>my_display=radar_display.radar_display(myradar)
f=figure(figsize=[15,5])
subplot(1,2,1)
my_display.plot_ppi(&#39;proc_dp_phase_shift&#39;, 0)
my_display.append_x()
my_display.append_y()
gca().set_title(my_display.generate_title(&#39;proc_dp_phase_shift&#39;, 0))
my_display.add_cb()
subplot(1,2,2)
my_display.plot_ppi(&#39;recalculated_diff_phase&#39;, 0)
gca().set_title(my_display.generate_title(&#39;recalculated_diff_phase&#39;, 0))
my_display.append_x()
my_display.add_cb()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2a8d7f27b75aa061c702ca6f29f0e3b47dda1a45fa334f1923f2bf644b79c1e8.png" src="../_images/2a8d7f27b75aa061c702ca6f29f0e3b47dda1a45fa334f1923f2bf644b79c1e8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>reload(rayplot)
myrayplot=rayplot.rayplot(myradar, figsize=[15,15])
myrayplot([0,190],myradar.fields.keys())
myrayplot.fig.subplots_adjust(wspace=1.0)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b7bd7beb379d2b0c88e421ee21306a2dffcf9376adc1327f747a26a586361f54.png" src="../_images/b7bd7beb379d2b0c88e421ee21306a2dffcf9376adc1327f747a26a586361f54.png" />
</div>
</div>

<div class="section">
   
</div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2013-2022, Py-ART developers.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>